[variables]
NIXPACKS_SPA_OUTPUT_DIR = "dist"
NODE_VERSION = "22"
NPM_CONFIG_CACHE = "/tmp/.npm"

[phases.install]
cmds = ["npm ci --omit=dev --no-audit --no-fund --cache=/tmp/.npm"]

[phases.build]
cmds = [
  "rm -rf node_modules/.cache || true",
  "rm -rf /tmp/.npm || true",
  "npm ci --include=dev --cache=/tmp/.npm",
  "npm run build"
]

[start]
cmd = "node server.js"